 <!DOCTYPE html>
 <html lang="en">
 <head>
    <meta charset="utf-8">

    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="./js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" href="./css/bootstrap-table.min.css">
    <link rel="stylesheet" href="./css/jquery.resizableColumns.min.css">

    <script src="./js/jquery-3.6.0.min.js"></script>
    <script src="./js/papaparse.min.js"></script>

    <script src="./js/ol.js"></script>
    <link rel="stylesheet" href="./css/ol.css" type="text/css">

    <script src="./js/utmconv.js"></script>
    <script src="./js/proj4.min.js"></script>

    <script src="./js/centros.js"></script>

    <title>Centros de enseñanza secundaria públicos del Gobierno Vasco</title>

    <style>
      .map {
          height: 700px;
          width: 90%;
          padding-bottom: 2rem;
          margin-left: auto;
          margin-right: auto;
      }
    </style>

</head>
<body>
  <nav class="navbar bg-body-secondary" data-bs-theme="dark">
    <div class="container-fluid">
      <a class="navbar-brand">Centros docentes no universitarios de Euskadi</a>
      <div id="toolbar" class="d-flex"></div>
    </div>
  </nav>

  <div class="container-fluid pt-5 pb-5">

        <table id="table"  class="table table-striped table-hover"
          data-buttons-toolbar="#toolbar"
          data-query-params="queryParams"
          data-pagination="true"
          data-search="true"
          data-advanced-search="true"
          data-id-table="advancedTable"
          data-resizable="true"
          data-filter-control="true"
          data-show-search-clear-button="true"
          data-show-export="true"
        >
          <thead class="table-dark">
            <tr>
              <th data-field="CCEN" data-sortable="true" data-filter-control="input">Código</th>
              <th data-field="NOME" data-sortable="true" data-filter-control="input">Nombre</th>
              <th data-field="DGENRC" data-sortable="true" data-filter-control="select">Tipo de Centro</th>
              <th data-field="DMUNIC" data-sortable="true" data-filter-control="select">Municipio</th>
              <th data-field="DTERRC" data-sortable="true" data-filter-control="select">Territorio</th>
              <th data-field="DOMI" data-sortable="true" data-filter-control="input">Dirección</th>
              <th data-field="CPOS" data-sortable="true" data-filter-control="select">C.P.</th>
              <th data-field="DTITUC" data-sortable="true" data-filter-control="select">Titulación</th>
            </tr>
          </thead>
        </table>

        <div id="map" class="map pt-5"><div id="popup"></div></div>
  </div>
</body>
</html>

<script type="text/javascript">
  // obtenemos el fichero CSV
  $(document).ready(function(){
    Papa.parse("https://opendata.euskadi.eus/contenidos/ds_localizaciones/centros_docentes_no_universit/es_euskadi/adjuntos/dirgennouniv.csv",{
      download: true,
      delimiter: ";",
      skipEmptyLines:true,
      header:true,
      complete: function(results, file) {
        // cuando esté parseado, se rellena la Bootstrap-table con los datos
        var $table = $('#table')
        $table.bootstrapTable({data: results.data})
      },
    });

  });

  // para el buscador de Bootstrap-table
  function queryParams() {
    var params = {}
    $('#toolbar').find('input[name]').each(function () {
      params[$(this).attr('name')] = $(this).val()
    })
    return params
  }





//   //proj4.defs([ [ 'EPSG:32647', '+proj=utm +zone=30 +ellps=WGS84 +datum=WGS84 +units=m +no_defs' ] ]);


centerLongitudeLatitude = new ol.proj.fromLonLat([-2.9407383, 43.2576896]);
// kudos of distance to: https://stackoverflow.com/questions/58067660/how-do-i-correctly-set-a-circles-radius-in-openlayers-for-a-specific-unit-of-me#58073291
// 25 means 25km
radius_distance = 25*1000/ol.proj.getPointResolution('EPSG:3857', 1, centerLongitudeLatitude);
const circleFeature = new ol.Feature({
  geometry: new ol.geom.Circle(centerLongitudeLatitude, radius_distance)
});
// del ejemplo https://openlayers.org/en/latest/examples/custom-circle-render.html
circleFeature.setStyle(
  new ol.style.Style({
    renderer(coordinates, state) {
      const [[x, y], [x1, y1]] = coordinates;
      const ctx = state.context;
      const dx = x1 - x;
      const dy = y1 - y;
      const radius = Math.sqrt(dx * dx + dy * dy);

      const innerRadius = 0;
      const outerRadius = radius * 1.4;

      // const gradient = ctx.createRadialGradient(
      //   x,
      //   y,
      //   innerRadius,
      //   x,
      //   y,
      //   outerRadius
      // );
      // gradient.addColorStop(0, 'rgba(255,0,0,0)');
      // gradient.addColorStop(0.6, 'rgba(255,0,0,0.2)');
      // gradient.addColorStop(1, 'rgba(255,0,0,0.8)');
      ctx.beginPath();
      ctx.arc(x, y, radius, 0, 2 * Math.PI, true);
      // ctx.fillStyle = gradient;
      // ctx.fill();

      ctx.arc(x, y, radius, 0, 2 * Math.PI, true);
      ctx.strokeStyle = 'rgba(255,0,0,1)';
      ctx.stroke();
    },
  })
);



var map = new ol.Map({
  target: 'map',
  layers: [
    new ol.layer.Tile({
      source: new ol.source.OSM(),
      visible: true,
    }),
    new ol.layer.Vector({
      source: new ol.source.Vector({
        features: [circleFeature],
      }),
    }),
  ],
  view: new ol.View({
    //projection: 'EPSG:4326', //for UTM ??? 
    center: ol.proj.fromLonLat([-2.4, 43.2455638]),
    zoom:10,
  })
});



</script>

<script src="./js/bootstrap-table.min.js"></script>
<script src="./js/bootstrap-table-toolbar.min.js"></script>
<script src="./js/jquery.resizableColumns.min.js"></script>
<script src="./js/bootstrap-table-resizable.min.js"></script>
<script src="./js/bootstrap-table-filter-control.min.js"></script>
<script src="./js/tableExport.min.js"></script>
<script src="./js/jspdf.min.js"></script>
<script src="./js/jspdf.plugin.autotable.js"></script>
<script src="./js/bootstrap-table-export.min.js"></script>
